<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Paparazzi UAS: ahrs_int_cmpl_quat module</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="penguin_icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Paparazzi UAS
   &#160;<span id="projectnumber">v6.2_unstable</span>
   </div>
   <div id="projectbrief">Paparazzi is a free software Unmanned Aircraft System.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('module__ahrs_int_cmpl_quat.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ahrs_int_cmpl_quat module </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>AHRS using complementary filter in fixed point.</b></p>
<p>Propagation is done in quaternion representation.</p>
<p>By default uses magnetometer for heading for rotorcrafts. For fixedwing firmware AHRS_GRAVITY_UPDATE_COORDINATED_TURN is enabled by default and magnetometer disabled (needs GPS).</p>
<p>To measure attitude angles, gyrometers measurements are integrated. The result of integration is accurate for short term, but gyro bias is accumulated, which results in long term errors (drift). On the other hand, accelerometers can be used to infer pitch/roll angles utilizing gravity vector measurement, but they suffer from noise due to vibrations. The measurement is then only accurate when averaged over a long term. Also, accelerometers alone are unable to give accurate angles when the vehicle is accelerating. Complementary filter takes advantage of both sensors, using a low-pass filter on accelerometer readings and high pass filter on gyrometers readings, to estimate attitude angles.</p>
<ul>
<li>No danger of gimbal lock, since quaternions are used.</li>
<li>The arithmetic is fixed point and is thus suitable if the processor (on your board) has no FPU.</li>
<li>Estimates the gyro bias.</li>
</ul>
<h1><a class="anchor" id="module_load_example__ahrs_int_cmpl_quat"></a>
Example for airframe file</h1>
<p>Add to your firmware section: This example contains all possible configuration options, not all of them are mandatory! </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">module</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ahrs_int_cmpl_quat&quot;</span>&gt;</div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;AHRS_MAG_UPDATE_ALL_AXES&quot; value=&quot;FALSE|TRUE&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;AHRS_USE_GPS_HEADING&quot; value=&quot;FALSE|TRUE&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;AHRS_GRAVITY_UPDATE_COORDINATED_TURN&quot; value=&quot;FALSE|TRUE&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;AHRS_GPS_SPEED_IN_NEGATIVE_Z_DIRECTION&quot; value=&quot;FALSE|TRUE&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;AHRS_PROPAGATE_LOW_PASS_RATES&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;AHRS_BIAS_UPDATE_HEADING_THRESHOLD&quot; value=&quot;5.0&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;AHRS_HEADING_UPDATE_GPS_MIN_SPEED&quot; value=&quot;5.0&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;AHRS_GRAVITY_HEURISTIC_FACTOR&quot; value=&quot;30&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;AHRS_ICQ_IMU_ID&quot; value=&quot;ABI_BROADCAST&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;AHRS_ICQ_MAG_ID&quot; value=&quot;ABI_BROADCAST&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;define name=&quot;AHRS_ICQ_GPS_ID&quot; value=&quot;GPS_MULTI_ID&quot; /&gt;\n  &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;configure name=&quot;USE_MAGNETOMETER&quot; value=&quot;TRUE&quot; /&gt;\n    &#39;</span></div>
<div class="line">  <span class="keyword">b</span><span class="stringliteral">&#39;&lt;configure name=&quot;AHRS_ALIGNER_LED&quot; value=&quot;1&quot; /&gt;\n    &#39;</span></div>
<div class="line">&lt;/<span class="keywordtype">module</span>&gt;</div>
</div><!-- fragment --> <h1><a class="anchor" id="configuration__ahrs_int_cmpl_quat"></a>
Module configuration options</h1>
<h2><a class="anchor" id="configure"></a>
Configure Options</h2>
<ul>
<li><b>name:</b> <code>USE_MAGNETOMETER</code> <b>value:</b> <em>TRUE</em> <br  />
 Description: set to FALSE to disable magnetometer</li>
<li><b>name:</b> <code>AHRS_ALIGNER_LED</code> <b>value:</b> <em>1</em> <br  />
 Description: LED number to indicate AHRS alignment, none to disable (default is board dependent)</li>
</ul>
<h2><a class="anchor" id="define"></a>
Define Options</h2>
<ul>
<li><b>name:</b> <code>AHRS_MAG_UPDATE_ALL_AXES</code> <b>value:</b> <em>FALSE|TRUE</em> <br  />
 Description: Use magnetometer to update all axes and not only yaw</li>
<li><b>name:</b> <code>AHRS_USE_GPS_HEADING</code> <b>value:</b> <em>FALSE|TRUE</em> <br  />
 Description: Use GPS course to update heading</li>
<li><b>name:</b> <code>AHRS_GRAVITY_UPDATE_COORDINATED_TURN</code> <b>value:</b> <em>FALSE|TRUE</em> <br  />
 Description: Compensation of centrifugal force via GPS speed (to fly in circles with a fixedwing)</li>
<li><b>name:</b> <code>AHRS_GPS_SPEED_IN_NEGATIVE_Z_DIRECTION</code> <b>value:</b> <em>FALSE|TRUE</em> <br  />
 Description: AHRS_GRAVITY_UPDATE_COORDINATED_TURN assumes the GPS speed is in the X axis direction. Quadshot, DelftaCopter and other hybrids can have the GPS speed in the negative Z direction</li>
<li><b>name:</b> <code>AHRS_PROPAGATE_LOW_PASS_RATES</code> <b>value:</b> <em>None</em> <br  />
 Description: apply a low pass filter on rotational velocity</li>
<li><b>name:</b> <code>AHRS_BIAS_UPDATE_HEADING_THRESHOLD</code> <b>value:</b> <em>5.0</em> <br  />
 Description: don't update gyro bias if heading deviation is above this threshold in degrees</li>
<li><b>name:</b> <code>AHRS_HEADING_UPDATE_GPS_MIN_SPEED</code> <b>value:</b> <em>5.0</em> <br  />
 Description: Don't update heading from GPS course if GPS ground speed is below is this threshold in m/s</li>
<li><b>name:</b> <code>AHRS_GRAVITY_HEURISTIC_FACTOR</code> <b>value:</b> <em>30</em> <br  />
 Description: Default is 30. Reduce accelerometer cut-off frequency when the vehicle is accelerating: norm(ax,ay,az) ~ 9,81 m/s2. WARNING: when the IMU is not well damped, the norm of accelerometers never equals to 9,81 m/s2. As a result, the GRAVITY_HEURISTIC_FACTOR will reduce the accelerometer bandwith even if the vehicle is not accelerating. Set to 0 in case of vibrations</li>
<li><b>name:</b> <code>AHRS_ICQ_IMU_ID</code> <b>value:</b> <em>ABI_BROADCAST</em> <br  />
 Description: ABI sender id of IMU to use</li>
<li><b>name:</b> <code>AHRS_ICQ_MAG_ID</code> <b>value:</b> <em>ABI_BROADCAST</em> <br  />
 Description: ABI sender id of magnetometer to use</li>
<li><b>name:</b> <code>AHRS_ICQ_GPS_ID</code> <b>value:</b> <em>GPS_MULTI_ID</em> <br  />
 Description: ABI sender id of GPS to use</li>
</ul>
<h1><a class="anchor" id="autoloads__ahrs_int_cmpl_quat"></a>
Auto-loaded modules</h1>
<p>The following modules are automatically loaded (just as if you had added them in the airframe file)</p><ul>
<li><a class="el" href="module__ahrs_sim.html">ahrs_sim module</a> </li>
</ul>
<h1><a class="anchor" id="files"></a>
Files</h1>
<h2><a class="anchor" id="sources"></a>
Source Files</h2>
<ul>
<li><a class="el" href="ahrs__int__cmpl__quat_8c.html">modules/ahrs/ahrs_int_cmpl_quat.c</a></li>
<li><a class="el" href="ahrs__int__cmpl__quat__wrapper_8c.html">modules/ahrs/ahrs_int_cmpl_quat_wrapper.c</a></li>
</ul>
<h2><a class="anchor" id="module_xml__ahrs_int_cmpl_quat"></a>
Raw ahrs_int_cmpl_quat.xml file:</h2>
<div class="fragment"><div class="line">&lt;!<span class="keyword">DOCTYPE</span> <span class="keyword">module</span> <span class="keyword">SYSTEM</span> <span class="stringliteral">&quot;module.dtd&quot;</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">module</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ahrs_int_cmpl_quat&quot;</span> <span class="keyword">dir</span>=<span class="stringliteral">&quot;ahrs&quot;</span> <span class="keyword">task</span>=<span class="stringliteral">&quot;estimation&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">doc</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">description</span>&gt;</div>
<div class="line">      <span class="keyword">AHRS</span> <span class="keyword">using</span> <span class="keyword">complementary</span> <span class="keyword">filter</span> <span class="keyword">in</span> <span class="keyword">fixed</span> <span class="keyword">point.</span></div>
<div class="line">      <span class="keyword">Propagation</span> <span class="keyword">is</span> <span class="keyword">done</span> <span class="keyword">in</span> <span class="keyword">quaternion</span> <span class="keyword">representation.</span></div>
<div class="line"> </div>
<div class="line">      <span class="keyword">By</span> <span class="keyword">default</span> <span class="keyword">uses</span> <span class="keyword">magnetometer</span> <span class="keyword">for</span> <span class="keyword">heading</span> <span class="keyword">for</span> <span class="keyword">rotorcrafts.</span></div>
<div class="line">      <span class="keyword">For</span> <span class="keyword">fixedwing</span> <span class="keyword">firmware</span> <span class="keyword">AHRS_GRAVITY_UPDATE_COORDINATED_TURN</span> <span class="keyword">is</span> <span class="keyword">enabled</span> <span class="keyword">by</span> <span class="keyword">default</span> <span class="keyword">and</span> <span class="keyword">magnetometer</span> <span class="keyword">disabled</span> (<span class="keyword">needs</span> <span class="keyword">GPS</span>).</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">To</span> <span class="keyword">measure</span> <span class="keyword">attitude</span> <span class="keyword">angles</span>, <span class="keyword">gyrometers</span> <span class="keyword">measurements</span> <span class="keyword">are</span> <span class="keyword">integrated.</span></div>
<div class="line">      <span class="keyword">The</span> <span class="keyword">result</span> <span class="keyword">of</span> <span class="keyword">integration</span> <span class="keyword">is</span> <span class="keyword">accurate</span> <span class="keyword">for</span> <span class="keyword">short</span> <span class="keyword">term</span>, <span class="keyword">but</span> <span class="keyword">gyro</span> <span class="keyword">bias</span> <span class="keyword">is</span> <span class="keyword">accumulated</span>, <span class="keyword">which</span> <span class="keyword">results</span> <span class="keyword">in</span> <span class="keyword">long</span> <span class="keyword">term</span> <span class="keyword">errors</span> (<span class="keyword">drift</span>).</div>
<div class="line">      <span class="keyword">On</span> <span class="keyword">the</span> <span class="keyword">other</span> <span class="keyword">hand</span>, <span class="keyword">accelerometers</span> <span class="keyword">can</span> <span class="keyword">be</span> <span class="keyword">used</span> <span class="keyword">to</span> <span class="keyword">infer</span> <span class="keyword">pitch</span>/<span class="keyword">roll</span> <span class="keyword">angles</span> <span class="keyword">utilizing</span> <span class="keyword">gravity</span> <span class="keyword">vector</span> <span class="keyword">measurement</span>, <span class="keyword">but</span> <span class="keyword">they</span> <span class="keyword">suffer</span> <span class="keyword">from</span> <span class="keyword">noise</span> <span class="keyword">due</span> <span class="keyword">to</span> <span class="keyword">vibrations.</span></div>
<div class="line">      <span class="keyword">The</span> <span class="keyword">measurement</span> <span class="keyword">is</span> <span class="keyword">then</span> <span class="keyword">only</span> <span class="keyword">accurate</span> <span class="keyword">when</span> <span class="keyword">averaged</span> <span class="keyword">over</span> <span class="keyword">a</span> <span class="keyword">long</span> <span class="keyword">term.</span></div>
<div class="line">      <span class="keyword">Also</span>, <span class="keyword">accelerometers</span> <span class="keyword">alone</span> <span class="keyword">are</span> <span class="keyword">unable</span> <span class="keyword">to</span> <span class="keyword">give</span> <span class="keyword">accurate</span> <span class="keyword">angles</span> <span class="keyword">when</span> <span class="keyword">the</span> <span class="keyword">vehicle</span> <span class="keyword">is</span> <span class="keyword">accelerating.</span></div>
<div class="line">      <span class="keyword">Complementary</span> <span class="keyword">filter</span> <span class="keyword">takes</span> <span class="keyword">advantage</span> <span class="keyword">of</span> <span class="keyword">both</span> <span class="keyword">sensors</span>, <span class="keyword">using</span> <span class="keyword">a</span> <span class="keyword">low-pass</span> <span class="keyword">filter</span> <span class="keyword">on</span> <span class="keyword">accelerometer</span> <span class="keyword">readings</span> <span class="keyword">and</span> <span class="keyword">high</span> <span class="keyword">pass</span> <span class="keyword">filter</span> <span class="keyword">on</span> <span class="keyword">gyrometers</span> <span class="keyword">readings</span>, <span class="keyword">to</span> <span class="keyword">estimate</span> <span class="keyword">attitude</span> <span class="keyword">angles.</span></div>
<div class="line"> </div>
<div class="line">      - <span class="keyword">No</span> <span class="keyword">danger</span> <span class="keyword">of</span> <span class="keyword">gimbal</span> <span class="keyword">lock</span>, <span class="keyword">since</span> <span class="keyword">quaternions</span> <span class="keyword">are</span> <span class="keyword">used.</span></div>
<div class="line">      - <span class="keyword">The</span> <span class="keyword">arithmetic</span> <span class="keyword">is</span> <span class="keyword">fixed</span> <span class="keyword">point</span> <span class="keyword">and</span> <span class="keyword">is</span> <span class="keyword">thus</span> <span class="keyword">suitable</span> <span class="keyword">if</span> <span class="keyword">the</span> <span class="keyword">processor</span> (<span class="keyword">on</span> <span class="keyword">your</span> <span class="keyword">board</span>) <span class="keyword">has</span> <span class="keyword">no</span> <span class="keyword">FPU.</span></div>
<div class="line">      - <span class="keyword">Estimates</span> <span class="keyword">the</span> <span class="keyword">gyro</span> <span class="keyword">bias.</span></div>
<div class="line">    &lt;/<span class="keywordtype">description</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">configure</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;USE_MAGNETOMETER&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;TRUE&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;set to FALSE to disable magnetometer&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">configure</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;AHRS_ALIGNER_LED&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;LED number to indicate AHRS alignment, none to disable (default is board dependent)&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;AHRS_MAG_UPDATE_ALL_AXES&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;FALSE|TRUE&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Use magnetometer to update all axes and not only yaw&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;AHRS_USE_GPS_HEADING&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;FALSE|TRUE&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Use GPS course to update heading&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;AHRS_GRAVITY_UPDATE_COORDINATED_TURN&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;FALSE|TRUE&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Compensation of centrifugal force via GPS speed (to fly in circles with a fixedwing)&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;AHRS_GPS_SPEED_IN_NEGATIVE_Z_DIRECTION&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;FALSE|TRUE&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;AHRS_GRAVITY_UPDATE_COORDINATED_TURN assumes the GPS speed is in the X axis direction. Quadshot, DelftaCopter and other hybrids can have the GPS speed in the negative Z direction&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;AHRS_PROPAGATE_LOW_PASS_RATES&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;apply a low pass filter on rotational velocity&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;AHRS_BIAS_UPDATE_HEADING_THRESHOLD&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;5.0&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;don&#39;t update gyro bias if heading deviation is above this threshold in degrees&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;AHRS_HEADING_UPDATE_GPS_MIN_SPEED&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;5.0&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Don&#39;t update heading from GPS course if GPS ground speed is below is this threshold in m/s&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;AHRS_GRAVITY_HEURISTIC_FACTOR&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;30&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Default is 30. Reduce accelerometer cut-off frequency when the vehicle is accelerating: norm(ax,ay,az) ~ 9,81 m/s2. WARNING: when the IMU is not well damped, the norm of accelerometers never equals to 9,81 m/s2. As a result, the GRAVITY_HEURISTIC_FACTOR will reduce the accelerometer bandwith even if the vehicle is not accelerating. Set to 0 in case of vibrations&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;AHRS_ICQ_IMU_ID&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;ABI_BROADCAST&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;ABI sender id of IMU to use&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;AHRS_ICQ_MAG_ID&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;ABI_BROADCAST&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;ABI sender id of magnetometer to use&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;AHRS_ICQ_GPS_ID&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;GPS_MULTI_ID&quot;</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;ABI sender id of GPS to use&quot;</span>/&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">doc</span>&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<span class="keywordtype">settings</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">dl_settings</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">dl_settings</span> <span class="keyword">NAME</span>=<span class="stringliteral">&quot;AHRS&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;ahrs_icq.gravity_heuristic_factor&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;50&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;modules/ahrs/ahrs_int_cmpl_quat&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;g_heuristic&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;AHRS_GRAVITY_HEURISTIC_FACTOR&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;uint8&quot;</span> <span class="keyword">persistent</span>=<span class="stringliteral">&quot;true&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;ahrs_icq.accel_omega&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0.02&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.02&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;0.2&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;modules/ahrs/ahrs_int_cmpl_quat&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;acc_omega&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;AHRS_ACCEL_OMEGA&quot;</span> <span class="keyword">unit</span>=<span class="stringliteral">&quot;rad/s&quot;</span> <span class="keyword">handler</span>=<span class="stringliteral">&quot;SetAccelOmega&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;float&quot;</span> <span class="keyword">persistent</span>=<span class="stringliteral">&quot;true&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;ahrs_icq.accel_zeta&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0.7&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.05&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;1.5&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;modules/ahrs/ahrs_int_cmpl_quat&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;acc_zeta&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;AHRS_ACCEL_ZETA&quot;</span> <span class="keyword">handler</span>=<span class="stringliteral">&quot;SetAccelZeta&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;float&quot;</span> <span class="keyword">persistent</span>=<span class="stringliteral">&quot;true&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;ahrs_icq.mag_omega&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0.02&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.01&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;0.1&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;modules/ahrs/ahrs_int_cmpl_quat&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;mag_omega&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;AHRS_MAG_OMEGA&quot;</span> <span class="keyword">unit</span>=<span class="stringliteral">&quot;rad/s&quot;</span> <span class="keyword">handler</span>=<span class="stringliteral">&quot;SetMagOmega&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;float&quot;</span> <span class="keyword">persistent</span>=<span class="stringliteral">&quot;true&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">dl_setting</span> <span class="keyword">var</span>=<span class="stringliteral">&quot;ahrs_icq.mag_zeta&quot;</span> <span class="keyword">min</span>=<span class="stringliteral">&quot;0.7&quot;</span> <span class="keyword">step</span>=<span class="stringliteral">&quot;0.05&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;1.5&quot;</span> <span class="keyword">module</span>=<span class="stringliteral">&quot;modules/ahrs/ahrs_int_cmpl_quat&quot;</span> <span class="keyword">shortname</span>=<span class="stringliteral">&quot;mag_zeta&quot;</span> <span class="keyword">param</span>=<span class="stringliteral">&quot;AHRS_MAG_ZETA&quot;</span> <span class="keyword">handler</span>=<span class="stringliteral">&quot;SetMagZeta&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;float&quot;</span> <span class="keyword">persistent</span>=<span class="stringliteral">&quot;true&quot;</span>/&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">dl_settings</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">dl_settings</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">settings</span>&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<span class="keywordtype">dep</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">depends</span>&gt;<span class="keyword">ahrs_common</span>,@<span class="keyword">imu</span>,@<span class="keyword">mag</span>|@<span class="keyword">gps</span>&lt;/<span class="keywordtype">depends</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">provides</span>&gt;<span class="keyword">ahrs</span>&lt;/<span class="keywordtype">provides</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">dep</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">autoload</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ahrs_sim&quot;</span>/&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<span class="keywordtype">makefile</span> <span class="keyword">target</span>=<span class="stringliteral">&quot;!sim|fbw&quot;</span> <span class="keyword">firmware</span>=<span class="stringliteral">&quot;fixedwing&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">configure</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;USE_MAGNETOMETER&quot;</span> <span class="keyword">default</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;AHRS_USE_GPS_HEADING&quot;</span> <span class="keyword">cond</span>=<span class="stringliteral">&quot;ifneq (,$(findstring $(USE_MAGNETOMETER),0 FALSE))&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;AHRS_GRAVITY_UPDATE_COORDINATED_TURN&quot;</span>/&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">makefile</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">makefile</span> <span class="keyword">target</span>=<span class="stringliteral">&quot;!sim|fbw&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">configure</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;USE_MAGNETOMETER&quot;</span> <span class="keyword">default</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;USE_MAGNETOMETER&quot;</span> <span class="keyword">cond</span>=<span class="stringliteral">&quot;ifeq (,$(findstring $(USE_MAGNETOMETER),0 FALSE))&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">file</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ahrs_int_cmpl_quat.c&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">file</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ahrs_int_cmpl_quat_wrapper.c&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">test</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;PRIMARY_AHRS&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;ahrs_icq&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;AHRS_TYPE_H&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;modules/ahrs/ahrs_int_cmpl_quat_wrapper.h&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;string&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;USE_MAGNETOMETER&quot;</span>/&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">test</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">test</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;PRIMARY_AHRS&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;ahrs_icq&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;AHRS_TYPE_H&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;modules/ahrs/ahrs_int_cmpl_quat_wrapper.h&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;string&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;AHRS_USE_GPS_HEADING&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">define</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;USE_GPS&quot;</span>/&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">test</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">raw</span>&gt;</div>
<div class="line"><span class="keyword">ifdef</span> <span class="keyword">SECONDARY_AHRS</span></div>
<div class="line"><span class="keyword">ifneq</span> (,$(<span class="keyword">findstring</span> $(<span class="keyword">SECONDARY_AHRS</span>), <span class="keyword">icq</span> <span class="keyword">int_cmpl_quat</span>))</div>
<div class="line"># <span class="keyword">this</span> <span class="keyword">is</span> <span class="keyword">the</span> <span class="keyword">secondary</span> <span class="keyword">AHRS</span></div>
<div class="line">$(<span class="keyword">TARGET</span>).<span class="keyword">CFLAGS</span> += -<span class="keyword">DAHRS_SECONDARY_TYPE_H</span>=\<span class="stringliteral">&quot;modules/ahrs/ahrs_int_cmpl_quat_wrapper.h\&quot;</span></div>
<div class="line">$(<span class="keyword">TARGET</span>).<span class="keyword">CFLAGS</span> += -<span class="keyword">DSECONDARY_AHRS</span>=<span class="keyword">ahrs_icq</span></div>
<div class="line"><span class="keyword">else</span></div>
<div class="line"># <span class="keyword">this</span> <span class="keyword">is</span> <span class="keyword">the</span> <span class="keyword">primary</span> <span class="keyword">AHRS</span></div>
<div class="line">$(<span class="keyword">TARGET</span>).<span class="keyword">CFLAGS</span> += -<span class="keyword">DAHRS_TYPE_H</span>=\<span class="stringliteral">&quot;modules/ahrs/ahrs_int_cmpl_quat_wrapper.h\&quot;</span></div>
<div class="line">$(<span class="keyword">TARGET</span>).<span class="keyword">CFLAGS</span> += -<span class="keyword">DPRIMARY_AHRS</span>=<span class="keyword">ahrs_icq</span></div>
<div class="line"><span class="keyword">endif</span></div>
<div class="line"><span class="keyword">else</span></div>
<div class="line"># <span class="keyword">plain</span> <span class="keyword">old</span> <span class="keyword">single</span> <span class="keyword">AHRS</span> <span class="keyword">usage</span></div>
<div class="line">$(<span class="keyword">TARGET</span>).<span class="keyword">CFLAGS</span> += -<span class="keyword">DAHRS_TYPE_H</span>=\<span class="stringliteral">&quot;modules/ahrs/ahrs_int_cmpl_quat_wrapper.h\&quot;</span></div>
<div class="line"><span class="keyword">endif</span></div>
<div class="line">    &lt;/<span class="keywordtype">raw</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">makefile</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">module</span>&gt;</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="onboard_modules.html">Onboard Modules</a></li>
    <li class="footer">Generated on Mon Jan 31 2022 16:25:10 for Paparazzi UAS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
